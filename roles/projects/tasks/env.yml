- name: Link "db" to localhost in /etc/hosts
  lineinfile:
    path: /etc/hosts
    line: "127.0.0.1 {{item}}"
    regexp: '^127\.0\.0\.1 {{item}}'
  become: true
  loop: "{{etchosts}}"

- name: Setup repo env files
  file:
    src: "{{role_path}}/files/{{item.src}}"
    path: "{{item.dest}}/.env"
    state: link
    force: true
  loop: "{{envfiles}}"
  tags:
    - envfiles

- name: Setup default .envrc files
  copy:
    src: "{{role_path}}/files/.envrc"
    dest: "{{item.dest}}/.envrc"
    force: false
  loop: "{{envfiles}}"
  tags:
    - envfiles

- name: Allow direnv on env files
  shell: direnv allow
  args:
    chdir: "{{item.dest}}"
  loop: "{{envfiles}}"
  changed_when: false
  tags:
    - envfiles
